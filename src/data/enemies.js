// V2 enemy definitions — Areas 1-3 (zones 1-30).
// Schema: id, name, hp, attack, attackSpeed, defense, armorPen, dot, zones, goldDrop, xpDrop,
//         sprites, spriteSize, spriteOffsetY, lootTable

const AREA_1_LOOT_TABLE = [
  // Common items (slot weights from LOOT_V2.slotWeights)
  { itemId: 'a1_sharpened_stick',      weight: 16 },  // weapon
  { itemId: 'a1_scavenged_hide_wrap',  weight: 15 },  // body
  { itemId: 'a1_bone_fragment_helm',   weight: 14 },  // head
  // Uncommon items (reduced weight)
  { itemId: 'a1_bone_shard_blade',     weight: 4 },   // weapon uncommon
  { itemId: 'a1_thick_pelt_vest',      weight: 3 },   // body uncommon
  { itemId: 'a1_hound_skull_cap',      weight: 3 },   // head uncommon
];

const AREA_2_LOOT_TABLE = [
  // Common Tier 1 (zones 6-10)
  { itemId: 'a2_salvaged_cleaver',        weight: 16 },
  { itemId: 'a2_patched_leather_vest',    weight: 15 },
  { itemId: 'a2_hardened_leather_hood',   weight: 14 },
  { itemId: 'a2_stitched_hide_leggings',  weight: 14 },
  { itemId: 'a2_worn_travelers_boots',    weight: 14 },
  // Common Tier 2 (zones 11-15)
  { itemId: 'a2_sharpened_cleaver',       weight: 16 },
  { itemId: 'a2_reinforced_leather_vest', weight: 15 },
  { itemId: 'a2_boiled_leather_hood',     weight: 14 },
  { itemId: 'a2_thick_hide_leggings',     weight: 14 },
  { itemId: 'a2_mended_travelers_boots',  weight: 14 },
  // Uncommon (zones 8-15)
  { itemId: 'a2_frontier_hatchet',        weight: 4 },
  { itemId: 'a2_rangers_coat',            weight: 3 },
  { itemId: 'a2_scouts_halfhelm',         weight: 3 },
  { itemId: 'a2_reinforced_trousers',     weight: 3 },
  { itemId: 'a2_wayfinder_boots',         weight: 3 },
];

const AREA_3_LOOT_TABLE = [
  // Common Tier A (zones 16-20)
  { itemId: 'a3_reclaimed_shortsword',    weight: 16 },
  { itemId: 'a3_road_wardens_hauberk',    weight: 15 },
  { itemId: 'a3_stone_carved_halfhelm',   weight: 14 },
  { itemId: 'a3_road_wardens_greaves',    weight: 14 },
  { itemId: 'a3_ironshod_marching_boots', weight: 14 },
  { itemId: 'a3_scavenged_gauntlets',     weight: 14 },
  // Common Tier B (zones 21-25)
  { itemId: 'a3_sentinels_blade',         weight: 16 },
  { itemId: 'a3_sentinel_half_plate',     weight: 15 },
  { itemId: 'a3_sentinels_visage',        weight: 14 },
  { itemId: 'a3_sentinel_greaves',        weight: 14 },
  { itemId: 'a3_sentinel_treads',         weight: 14 },
  { itemId: 'a3_sentinel_gauntlets',      weight: 14 },
  { itemId: 'a3_cracked_hearthstone',     weight: 13 },
  // Common Tier C (zones 26-30)
  { itemId: 'a3_keepers_longsword',       weight: 16 },
  { itemId: 'a3_keepers_wardplate',       weight: 15 },
  { itemId: 'a3_keepers_crown',           weight: 14 },
  { itemId: 'a3_keepers_legguards',       weight: 14 },
  { itemId: 'a3_keepers_stride',          weight: 14 },
  { itemId: 'a3_keepers_grip',            weight: 14 },
  { itemId: 'a3_warm_hearthstone',        weight: 13 },
  // Uncommon
  { itemId: 'a3_wardens_oath',            weight: 4 },
  { itemId: 'a3_ancient_sentinel_plate',  weight: 3 },
  { itemId: 'a3_visage_of_the_first',     weight: 3 },
  { itemId: 'a3_stoneguard_legplates',    weight: 3 },
  { itemId: 'a3_pathfinders_stride',      weight: 3 },
  { itemId: 'a3_irongrip_gauntlets',      weight: 3 },
  { itemId: 'a3_heartstone_pendant',      weight: 3 },
];

const ENEMIES = [
  // ── Area 1: The Harsh Threshold (zones 1-5) ────────────────────────
  {
    id: 'a1_hollow_slime',
    name: 'Hollow Slime',
    hp: 75,
    attack: 5,
    attackSpeed: 0.7,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [1, 2],
    goldDrop: 3,
    xpDrop: 3,
    sprites: {
      default: 'slime001_default',
      reaction: 'slime001_reaction',
      attack: 'slime001_attack',
      dead: 'slime001_dead',
    },
    spriteSize: { w: 160, h: 240 },
    spriteOffsetY: 0,
    lootTable: AREA_1_LOOT_TABLE,
  },
  {
    id: 'a1_forest_rat',
    name: 'Forest Rat',
    hp: 90,
    attack: 7,
    attackSpeed: 1.4,
    defense: -10,
    armorPen: 0,
    dot: null,
    zones: [1, 3],
    goldDrop: 4,
    xpDrop: 4,
    sprites: {
      default: 'forestrat001_default',
      reaction: 'forestrat001_reaction',
      attack: 'forestrat001_attack',
      dead: 'forestrat001_dead',
    },
    spriteSize: { w: 125, h: 125 },
    spriteOffsetY: 0,
    lootTable: AREA_1_LOOT_TABLE,
  },
  {
    id: 'a1_feral_hound',
    name: 'Feral Hound',
    hp: 100,
    attack: 9,
    attackSpeed: 1.2,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [1, 3],
    goldDrop: 5,
    xpDrop: 5,
    sprites: {
      default: 'feralhound_default',
      reaction: 'feralhound_reaction',
      attack: 'feralhound_attack',
      dead: 'feralhound_dead',
    },
    spriteSize: { w: 256, h: 140 },
    spriteOffsetY: -20,
    lootTable: AREA_1_LOOT_TABLE,
  },
  {
    id: 'a1_thornback_boar',
    name: 'Thornback Boar',
    hp: 105,
    attack: 15,
    attackSpeed: 0.8,
    defense: 10,
    armorPen: 0,
    dot: null,
    zones: [2, 4],
    goldDrop: 10,
    xpDrop: 10,
    sprites: {
      default: 'thornbackboar_default',
      reaction: 'thornbackboar_reaction',
      attack: 'thornbackboar_attack',
      dead: 'thornbackboar_dead',
    },
    spriteSize: { w: 280, h: 153 },
    spriteOffsetY: -50,
    lungeDistance: 40,
    lootTable: AREA_1_LOOT_TABLE,
  },
  {
    id: 'a1_blighted_stalker',
    name: 'Blighted Stalker',
    hp: 130,
    attack: 21,
    attackSpeed: 1.0,
    defense: 10,
    armorPen: 0,
    dot: null,
    zones: [3, 5],
    goldDrop: 14,
    xpDrop: 14,
    sprites: {
      default: 'blightedstalker_default',
      reaction: 'blightedstalker_reaction',
      attack: 'blightedstalker_attack',
      dead: 'blightedstalker_dead',
    },
    spriteSize: { w: 198, h: 239 },
    spriteOffsetY: -50,
    lootTable: AREA_1_LOOT_TABLE,
  },

  // ── Area 2: The Overgrown Frontier (zones 6-15) ────────────────────
  {
    id: 'a2_rot_vine_crawler',
    name: 'Rot Vine Crawler',
    hp: 85,
    attack: 42,
    attackSpeed: 1.0,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [6, 9],
    goldDrop: 21,
    xpDrop: 21,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_2_LOOT_TABLE,
  },
  {
    id: 'a2_mire_lurker',
    name: 'Mire Lurker',
    hp: 120,
    attack: 55,
    attackSpeed: 0.7,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [8, 12],
    goldDrop: 30,
    xpDrop: 30,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_2_LOOT_TABLE,
  },
  {
    id: 'a2_wisp_swarm',
    name: 'Wisp Swarm',
    hp: 55,
    attack: 30,
    attackSpeed: 1.5,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [9, 13],
    goldDrop: 14,
    xpDrop: 14,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_2_LOOT_TABLE,
  },
  {
    id: 'a2_blight_stalker_evolved',
    name: 'Blight Stalker (Evolved)',
    hp: 105,
    attack: 48,
    attackSpeed: 1.0,
    defense: 0,
    armorPen: 0,
    dot: 2,
    zones: [11, 14],
    goldDrop: 26,
    xpDrop: 26,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_2_LOOT_TABLE,
  },
  {
    id: 'a2_bog_revenant',
    name: 'Bog Revenant',
    hp: 160,
    attack: 62,
    attackSpeed: 0.9,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [13, 15],
    goldDrop: 40,
    xpDrop: 40,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_2_LOOT_TABLE,
  },

  // ── Area 3: The Broken Road (zones 16-30) ──────────────────────────

  // Sub-Region A: The Weathered Path (zones 16-20)
  {
    id: 'a3_stone_sentry',
    name: 'Stone Sentry',
    hp: 220,
    attack: 80,
    attackSpeed: 0.6,
    defense: 10,
    armorPen: 0,
    dot: null,
    zones: [16, 20],
    goldDrop: 55,
    xpDrop: 55,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },
  {
    id: 'a3_fractured_echo',
    name: 'Fractured Echo',
    hp: 100,
    attack: 55,
    attackSpeed: 2.0,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [16, 19],
    goldDrop: 25,
    xpDrop: 25,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },
  {
    id: 'a3_ruin_pilgrim',
    name: 'Ruin Pilgrim',
    hp: 155,
    attack: 65,
    attackSpeed: 1.1,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [18, 20],
    goldDrop: 39,
    xpDrop: 39,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },

  // Sub-Region B: The Outer Ruins (zones 21-25)
  {
    id: 'a3_shade_remnant',
    name: 'Shade Remnant',
    hp: 165,
    attack: 72,
    attackSpeed: 1.0,
    defense: 0,
    armorPen: 0.3,
    dot: null,
    zones: [21, 25],
    goldDrop: 41,
    xpDrop: 41,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },
  {
    id: 'a3_blighted_guardian',
    name: 'Blighted Guardian',
    hp: 240,
    attack: 90,
    attackSpeed: 0.9,
    defense: 15,
    armorPen: 0,
    dot: null,
    zones: [22, 25],
    goldDrop: 60,
    xpDrop: 60,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },
  {
    id: 'a3_ruin_pilgrim_frenzied',
    name: 'Ruin Pilgrim (Frenzied)',
    hp: 175,
    attack: 68,
    attackSpeed: 1.3,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [21, 24],
    goldDrop: 44,
    xpDrop: 44,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },

  // Sub-Region C: The Inner Sanctum (zones 26-30)
  {
    id: 'a3_hearthguard_construct',
    name: 'Hearthguard Construct',
    hp: 310,
    attack: 95,
    attackSpeed: 0.7,
    defense: 20,
    armorPen: 0,
    dot: null,
    zones: [26, 30],
    goldDrop: 78,
    xpDrop: 78,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },
  {
    id: 'a3_blighted_scholar',
    name: 'Blighted Scholar',
    hp: 200,
    attack: 78,
    attackSpeed: 1.0,
    defense: 0,
    armorPen: 0.25,
    dot: 3,
    zones: [27, 30],
    goldDrop: 50,
    xpDrop: 50,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },
  {
    id: 'a3_corruption_tendril',
    name: 'Corruption Tendril',
    hp: 130,
    attack: 58,
    attackSpeed: 1.8,
    defense: 0,
    armorPen: 0,
    dot: null,
    zones: [26, 29],
    goldDrop: 33,
    xpDrop: 33,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },
  {
    id: 'a3_shade_of_the_keeper',
    name: 'Shade of the Keeper',
    hp: 250,
    attack: 88,
    attackSpeed: 0.9,
    defense: 0,
    armorPen: 0.35,
    dot: null,
    zones: [28, 30],
    goldDrop: 63,
    xpDrop: 63,
    sprites: null,
    spriteSize: null,
    spriteOffsetY: 0,
    lootTable: AREA_3_LOOT_TABLE,
  },
];

// ── Backward-compat: `area` getter derived from zones ─────────────
for (const e of ENEMIES) {
  Object.defineProperty(e, 'area', {
    get() {
      // Derive area from zone start: zones 1-5 = area 1, 6-15 = area 2, 16-30 = area 3
      if (this.zones[0] <= 5) return 1;
      if (this.zones[0] <= 15) return 2;
      return 3;
    },
    enumerable: false,
  });
}

export function getEnemiesForZone(zone) {
  return ENEMIES.filter(e => zone >= e.zones[0] && zone <= e.zones[1]);
}

export function getRandomEnemy(zone) {
  const pool = getEnemiesForZone(zone);
  if (pool.length === 0) return null;
  return pool[Math.floor(Math.random() * pool.length)];
}

export function getEnemyById(id) {
  return ENEMIES.find(e => e.id === id) ?? null;
}

// Primary export + backward-compat alias
export { ENEMIES, ENEMIES as WORLD_1_ENEMIES };
